#!/usr/bin/python3

"""FLAC-ize albums in my collection.

It's inconvenient for me when my preferred audio player comingles FLAC albums
and my preferred portable formats under the same album heading. This script
adds "[FLAC]" at the end of each FLAC album."""

import sys
import glob
from mutagen import flac
from pprint import pprint

root = '/mnt/bluewest/Music/'

for ffile in glob.iglob(root+"**/*.flac", recursive=True):
	try:
		f = flac.FLAC(ffile)
		if len(f['album']) > 1:
			raise IndexError("Found multiple 'album' tags")
			# For some odd reason 'album' returns a list when read
		if f['album'][0].endswith('[FLAC]'):
			continue
		f['album'] = f['album'][0]+' [FLAC]'
		# ^^^ This is odd behavior in mutagen: it seems like we are suppose to
		# assign to the 'album' key, rather than to each object in its list.
		print(ffile, '=>', f['album'][0])
		f.save()

	except KeyError:
		# print("No suitable tags in", ffile, file=sys.stderr)
		pass
	except IndexError as err:
		print(err, 'in', ffile, file=sys.stderr)
		pass
